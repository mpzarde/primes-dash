# Primes Dashboard

A web-based dashboard for monitoring the [prime-cubes](https://github.com/mpzarde/prime-cubes) project's computation results. This application provides real-time updates of prime cube calculations by parsing and monitoring log files generated by the prime-cubes project. The dashboard is designed for monitoring only and does not include functionality for launching or managing computation jobs.

## Architecture

### Overview

Primes Dashboard is a full-stack JavaScript/TypeScript application with:

- **Backend**: Node.js with Express and Socket.IO
- **Frontend**: Angular 15 with Angular Material
- **Communication**: REST API and real-time WebSocket updates

### Backend Architecture

The backend is built with Express.js and TypeScript, providing:

- **Log Parsing Service**: Monitors and parses log files from the prime-cubes project
- **Real-time Updates**: Uses Socket.IO to push updates to connected clients
- **REST API**: Provides endpoints for retrieving batch summaries, solutions, and system state

Key components:
- **Log Parser**: Parses summary.log and run_*.log files to extract batch and solution data
- **Socket Service**: Manages real-time communication with clients
- **API Routes**: Express routes for data retrieval

### Frontend Architecture

The frontend is built with Angular 15, featuring:

- **Angular Material**: UI component library for a consistent look and feel
- **Socket.IO Client**: Real-time communication with the backend
- **Responsive Design**: Works on desktop and mobile devices

## Development Setup

### Prerequisites

- Node.js (v18.0.0 or higher)
- npm (v8.0.0 or higher)
- Angular CLI (v15.2.11)
- Access to the prime-cubes project logs directory

### Installation

1. Clone the repository:
   ```bash
   git clone <repository-url>
   cd primes-dash
   ```

2. Install dependencies for all workspaces:
   ```bash
   npm run install:all
   ```

3. Configure the backend:
   Create a `.env` file in the `backend` directory with the following content:
   ```
   LOGS_PATH=/path/to/prime-cubes/logs
   PORT=3000
   NODE_ENV=development
   ```

4. Start the development server:

   ```bash
   npm start
   # or explicitly
   npm run start:dev
   ```
   This will build the frontend and then start the backend server which will serve both the API and the frontend.

5. Access the application:
   - Everything runs on: http://localhost:3000

### Development Workflow

#### Development Process

- **Combined Development**:
  ```bash
  npm start
  # or explicitly
  npm run start:dev
  ```
  This builds the frontend and starts the backend server which serves both.

  After making frontend changes, you'll need to rebuild:
  ```bash
  npm run build:frontend
  ```

- **Backend Development Only**: 
  ```bash
  cd backend
  npm run dev
  ```
  This starts the backend with ts-node-dev for automatic reloading.

- **Frontend Development Only** (for UI development without backend integration):
  ```bash
  cd frontend
  npm start
  ```
  This starts the Angular development server. Note that this mode is not recommended as API calls will not work properly. For most development scenarios, use the combined development approach above.

## Production Build

### Building for Production

1. Build everything:
   ```bash
   npm run build
   ```
   This will build both the backend and frontend. The frontend files will be in `frontend/dist/` and the backend files in `backend/dist/`.

   Alternatively, you can build them separately:
   ```bash
   npm run build:frontend  # Build only the frontend
   npm run build:backend   # Build only the backend
   ```

### Deployment

1. Set up environment variables on your production server:
   ```
   LOGS_PATH=/path/to/prime-cubes/logs
   PORT=3000
   NODE_ENV=production
   ```

2. Deploy the application:
   - Copy both the `backend/dist` and `frontend/dist/frontend` directories to your server
   - Install production dependencies:
     ```bash
     cd backend
     npm install --production
     ```
   - Use the run-prod.sh script to build and start the server in production mode:
     ```bash
     ./run-prod.sh
     ```

   The script provides several commands:
   ```bash
   ./run-prod.sh start    # Build and start the server in the background
   ./run-prod.sh stop     # Stop the running server
   ./run-prod.sh status   # Check if the server is running
   ./run-prod.sh logs     # Display the server logs
   ./run-prod.sh logs follow  # Follow the logs in real-time
   ```

   The backend server will automatically serve the frontend static files from the `frontend/dist/frontend` directory.

3. For a more robust deployment, consider using:
   - Nginx or Apache as a reverse proxy
   - Docker containers for consistent environments

## Configuration

### Backend Configuration

The backend is configured using environment variables:

| Variable | Description | Default |
|----------|-------------|---------|
| LOGS_PATH | Path to the prime-cubes logs directory | /Users/mpzarde/projects/prime-cubes/logs |
| PORT | Server port | 3000 |
| NODE_ENV | Environment (development/production) | development |

### Frontend Configuration

The frontend uses a simplified configuration approach:

- **`environment.ts`**: Single environment file for all modes

#### Environment Configuration

The application uses a single environment file (`environment.ts`) that works for both development and production:

```typescript
export const environment = {
  production: false,  // Always development mode when using dev server
  apiBaseUrl: ''     // Always use relative URLs
};
```

This simplified approach assumes:
- The frontend is always accessed via proper hostnames
- Relative URLs work in all scenarios
- No need for environment file switching complexity

#### Backend Connection

The backend configuration is streamlined for security:

- Everything runs on a single server (port 3000)
- API calls use relative URLs (e.g., `/api/*`)
- WebSocket connections use relative URLs (e.g., `/socket.io/*`)

## Features

- **Real-time Updates**: Get immediate notifications when new solutions are found
- **Batch Summaries**: View summaries of computation batches with detailed statistics
- **Solution Explorer**: Browse, filter, and analyze solutions with interactive tables
- **Responsive Design**: Access the dashboard from desktop or mobile devices

## Contributing

1. Fork the repository
2. Create a feature branch: `git checkout -b feature/my-feature`
3. Commit your changes: `git commit -am 'Add my feature'`
4. Push to the branch: `git push origin feature/my-feature`
5. Submit a pull request

## License

MIT
